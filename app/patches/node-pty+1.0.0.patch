diff --git a/node_modules/node-pty/src/win/conpty.cc b/node_modules/node-pty/src/win/conpty.cc
index 47af75c..884d542 100644
--- a/node_modules/node-pty/src/win/conpty.cc
+++ b/node_modules/node-pty/src/win/conpty.cc
@@ -472,10 +472,6 @@ static NAN_METHOD(PtyKill) {
       }
     }
 
-    DisconnectNamedPipe(handle->hIn);
-    DisconnectNamedPipe(handle->hOut);
-    CloseHandle(handle->hIn);
-    CloseHandle(handle->hOut);
     CloseHandle(handle->hShell);
   }
 
diff --git a/node_modules/node-pty/lib/conpty_console_list_agent.js b/node_modules/node-pty/lib/conpty_console_list_agent.js
index abc1234..def5678 100644
--- a/node_modules/node-pty/lib/conpty_console_list_agent.js
+++ b/node_modules/node-pty/lib/conpty_console_list_agent.js
@@ -14,7 +14,16 @@ if (process.argv.length !== 3) {
 }
 
 var shellPid = parseInt(process.argv[2]);
-var consoleProcessList = getConsoleProcessList(shellPid);
+var consoleProcessList;
+try {
+  consoleProcessList = getConsoleProcessList(shellPid);
+} catch (e) {
+  // Silently fail if AttachConsole fails - this can happen in certain environments
+  // where the console is not accessible. Return an empty list to prevent crashes.
+  console.error('Warning: Could not get console process list:', e.message);
+  consoleProcessList = [];
+}
+
 process.stdout.write(JSON.stringify(consoleProcessList));
 process.exit(0);
 
